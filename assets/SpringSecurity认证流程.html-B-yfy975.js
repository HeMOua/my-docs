import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as n,o as e}from"./app-DOkRBtKU.js";const l="/assets/Untitled%20diagram-2025-04-13-041823-k21ujphU.png",t="/assets/image-20250413193517547-B_SgKLho.png",h="/assets/image-20250413194128195-COEYZ5_7.png",k="/assets/image-20250413194502607-8ncZde9o.png",p="/assets/image-20250413195123706-Xz8wIfT_.png",r="/assets/image-20250413200521432-CEqGzYrl.png",d="/assets/image-20250413195345945-r7EpFmMS.png",g="/assets/image-20250413195916730-DOtx-Uc7.png",c="/assets/image-20250413200417847-DY4buHvt.png",A="/assets/image-20250413201155502-BYfm5DVJ.png",B="/assets/image-20250413201245841-DePevwBo.png",y={};function o(u,i){return e(),a("div",null,i[0]||(i[0]=[n('<h1 id="springsecurity-è®¤è¯æµç¨‹å…¨è§£æ" tabindex="-1"><a class="header-anchor" href="#springsecurity-è®¤è¯æµç¨‹å…¨è§£æ"><span>SpringSecurity è®¤è¯æµç¨‹å…¨è§£æ</span></a></h1><h2 id="å¼•è¨€" tabindex="-1"><a class="header-anchor" href="#å¼•è¨€"><span>å¼•è¨€</span></a></h2><blockquote><p>Spring Security æ˜¯ Spring å…¨å®¶æ¡¶ä¸­ç”¨äºå¤„ç†å®‰å…¨è®¤è¯ä¸æˆæƒçš„æ ¸å¿ƒæ¨¡å—ã€‚æœ¬æ–‡å°†èšç„¦åœ¨â€œè®¤è¯æµç¨‹â€çš„æœºåˆ¶è§£æï¼Œå¸®åŠ©ä½ ç†è§£ä»æäº¤ç”¨æˆ·åå¯†ç å¼€å§‹ï¼Œåˆ°ç™»å½•æˆåŠŸèƒŒååˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p></blockquote><h2 id="è®¤è¯æµç¨‹è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#è®¤è¯æµç¨‹è¯¦è§£"><span>è®¤è¯æµç¨‹è¯¦è§£</span></a></h2><h3 id="æ€»ä½“æµç¨‹æ€»è§ˆ" tabindex="-1"><a class="header-anchor" href="#æ€»ä½“æµç¨‹æ€»è§ˆ"><span>æ€»ä½“æµç¨‹æ€»è§ˆ</span></a></h3><p>Spring Security çš„è¡¨å•è®¤è¯æµç¨‹ï¼Œå¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="'+l+'" alt="Untitled diagram-2025-04-13-041823" tabindex="0" loading="lazy"><figcaption>Untitled diagram-2025-04-13-041823</figcaption></figure><ol><li><p>ç”¨æˆ·å‘èµ·ç™»å½•è¯·æ±‚</p></li><li><p>è¯†åˆ«åˆ° <code>/login</code> ç™»å½•è¯·æ±‚ï¼Œäº¤ç»™ <code>UsernamePasswordAuthenticationFilter</code> è¿‡æ»¤å™¨å¤„ç†</p></li><li><p>ä»è¯·æ±‚ä¸­æå–ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶å°è£…æˆ <code>UsernamePasswordAuthenticationToken</code>ï¼Œç„¶åè°ƒç”¨ <code>AuthenticationManager</code> çš„ <code>authenticate()</code> è®¤è¯æ–¹æ³•</p></li><li><p>è°ƒç”¨ <code>ProviderManager.authenticate()</code>ï¼Œå®ƒä¼šéå†æ‰€æœ‰ <code>supports</code> çš„ <code>AuthenticationProvider</code></p></li><li><p>é»˜è®¤æ˜¯ <code>DaoAuthenticationProvider</code> ï¼Œè°ƒç”¨ <code>authenticate()</code></p><ul><li><p>è°ƒç”¨ <code>retrieveUser()</code> -&gt; <code>UserDetailsService.loadUserByUsername()</code></p></li><li><p>æ ¡éªŒå¯†ç ï¼š<code>additionalAuthenticationChecks()</code></p></li></ul></li><li><p>è¿”å›å·²è®¤è¯ Authentication å¯¹è±¡ï¼Œå­˜å…¥ SecurityContextHolder</p></li></ol><p>ğŸ’¡ è¡¥å……è¯´æ˜ï¼š</p><ul><li>å¦‚æœä½ æ˜¯å‰åç«¯åˆ†ç¦»ï¼Œä¸€èˆ¬ä¸ä¼šä½¿ç”¨é»˜è®¤çš„ <code>UsernamePasswordAuthenticationFilter</code>ï¼Œè€Œæ˜¯é€šè¿‡è‡ªå®šä¹‰ç™»å½•æ¥å£ç›´æ¥è°ƒç”¨ <code>AuthenticationManager.authenticate(...)</code>ã€‚</li><li>æ— è®ºæ˜¯å¦å‰åç«¯åˆ†ç¦»ï¼Œæ ¸å¿ƒè®¤è¯æµç¨‹ä¸å˜ã€‚</li></ul><h3 id="æ ¸å¿ƒç»„ä»¶ä½œç”¨è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒç»„ä»¶ä½œç”¨è¯´æ˜"><span>æ ¸å¿ƒç»„ä»¶ä½œç”¨è¯´æ˜</span></a></h3><table><thead><tr><th>ç»„ä»¶åç§°</th><th>ä½œç”¨è¯´æ˜</th><th>å¸¸è§å®ç°ç±» / æ¥å£</th></tr></thead><tbody><tr><td><code>UsernamePasswordAuthenticationFilter</code></td><td>æ‹¦æˆªè¡¨å•ç™»å½•è¯·æ±‚ï¼Œæå–ç”¨æˆ·åå¯†ç ï¼Œç”Ÿæˆ <code>UsernamePasswordAuthenticationToken</code></td><td><code>org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter</code></td></tr><tr><td><code>AuthenticationManager</code></td><td>æ ¸å¿ƒè®¤è¯ç®¡ç†å™¨ï¼Œè´Ÿè´£è°ƒåº¦è®¤è¯æµç¨‹</td><td><code>ProviderManager</code>ï¼ˆé»˜è®¤å®ç°ï¼‰</td></tr><tr><td><code>AuthenticationProvider</code></td><td>å®é™…æ‰§è¡Œè®¤è¯é€»è¾‘ï¼ˆç”¨æˆ·åå¯†ç æ ¡éªŒï¼‰</td><td><code>DaoAuthenticationProvider</code>ï¼ˆé»˜è®¤å®ç°ï¼‰</td></tr><tr><td><code>UserDetailsService</code></td><td>åŠ è½½ç”¨æˆ·ä¿¡æ¯ï¼ˆé€šå¸¸ä»æ•°æ®åº“æŸ¥è¯¢ï¼‰</td><td>è‡ªå®šä¹‰å®ç°ï¼Œå¦‚ <code>UserDetailsServiceImpl</code></td></tr><tr><td><code>UserDetails</code></td><td>ç”¨æˆ·å¯¹è±¡æŠ½è±¡ï¼ˆåŒ…å«ç”¨æˆ·åã€å¯†ç ã€æƒé™ç­‰ï¼‰</td><td>è‡ªå®šä¹‰å®ç°æˆ–ç›´æ¥ç”¨ <code>User</code> å®ä¾‹</td></tr><tr><td><code>SecurityContextHolder</code></td><td>å®‰å…¨ä¸Šä¸‹æ–‡å­˜å‚¨å™¨ï¼Œä¿å­˜å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯</td><td>çº¿ç¨‹å®‰å…¨çš„ <code>ThreadLocal</code> æŒä¹…åŒ–è®¤è¯ä¿¡æ¯</td></tr></tbody></table><hr><h3 id="æ ¸å¿ƒæµç¨‹è§£æ" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒæµç¨‹è§£æ"><span>æ ¸å¿ƒæµç¨‹è§£æ</span></a></h3><h4 id="è¯·æ±‚è¿›å…¥-springsecurity-è¿‡æ»¤å™¨é“¾" tabindex="-1"><a class="header-anchor" href="#è¯·æ±‚è¿›å…¥-springsecurity-è¿‡æ»¤å™¨é“¾"><span>è¯·æ±‚è¿›å…¥ SpringSecurity è¿‡æ»¤å™¨é“¾</span></a></h4><p>Spring Security é…ç½®äº†ä¸€ä¸ª <strong>FilterChainProxy</strong>ï¼Œå®ƒå†…éƒ¨æœ‰ä¸€ç³»åˆ—è¿‡æ»¤å™¨ï¼ˆFilterï¼‰ï¼Œç”¨äºå¤„ç†å®‰å…¨ç›¸å…³çš„ä»»åŠ¡ï¼š</p><p>æ¯”å¦‚ï¼š</p><ul><li><code>UsernamePasswordAuthenticationFilter</code>ï¼šå¤„ç†è¡¨å•ç™»å½•è®¤è¯</li><li><code>BasicAuthenticationFilter</code>ï¼šå¤„ç† HTTP Basic è®¤è¯</li><li><code>SecurityContextPersistenceFilter</code>ï¼šä» session ä¸­æ¢å¤è®¤è¯ä¿¡æ¯</li><li><code>ExceptionTranslationFilter</code>ï¼šå¤„ç†å¼‚å¸¸å’Œé‡å®šå‘ç™»å½•é¡µ</li><li><code>FilterSecurityInterceptor</code>ï¼šæœ€åæ‹¦æˆªè¯·æ±‚è¿›è¡Œæˆæƒåˆ¤æ–­</li></ul><hr><h4 id="æ•è·ç™»å½•è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#æ•è·ç™»å½•è¯·æ±‚"><span>æ•è·ç™»å½•è¯·æ±‚</span></a></h4><p>å½“æˆ‘ä»¬æäº¤è¡¨å•åˆ° <code>/login</code>ï¼ˆé»˜è®¤ï¼‰ï¼Œè¿™ä¸ªè¿‡æ»¤å™¨ä¼šæ‰§è¡Œï¼š</p><ul><li>ä»è¯·æ±‚ä¸­æå–ç”¨æˆ·åå’Œå¯†ç </li><li>å°è£…æˆ <code>UsernamePasswordAuthenticationToken</code>ï¼ˆå®ç°äº† <code>Authentication</code> æ¥å£ï¼‰</li></ul><figure><img src="'+t+'" alt="image-20250413193517547" tabindex="0" loading="lazy"><figcaption>image-20250413193517547</figcaption></figure><hr><h4 id="è°ƒç”¨-authenticationmanager-è¿›è¡Œè®¤è¯" tabindex="-1"><a class="header-anchor" href="#è°ƒç”¨-authenticationmanager-è¿›è¡Œè®¤è¯"><span>è°ƒç”¨ <code>AuthenticationManager</code> è¿›è¡Œè®¤è¯</span></a></h4><ul><li><code>UsernamePasswordAuthenticationFilter</code> è°ƒç”¨ <code>AuthenticationManager.authenticate(...)</code></li><li>é»˜è®¤æ˜¯ <code>ProviderManager</code>ï¼Œå®ƒä¼šéå†æ‰€æœ‰ <code>AuthenticationProvider</code></li></ul><figure><img src="'+h+'" alt="image-20250413194128195" tabindex="0" loading="lazy"><figcaption>image-20250413194128195</figcaption></figure><figure><img src="'+k+'" alt="image-20250413194502607" tabindex="0" loading="lazy"><figcaption>image-20250413194502607</figcaption></figure><hr><h4 id="è®¤è¯æä¾›è€…-authenticationprovider" tabindex="-1"><a class="header-anchor" href="#è®¤è¯æä¾›è€…-authenticationprovider"><span>è®¤è¯æä¾›è€… <code>AuthenticationProvider</code></span></a></h4><figure><img src="'+p+'" alt="image-20250413195123706" tabindex="0" loading="lazy"><figcaption>image-20250413195123706</figcaption></figure><p>é»˜è®¤ä½¿ç”¨çš„æ˜¯ <code>DaoAuthenticationProvider</code>ï¼Œå®ƒä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œ</p><ul><li>è°ƒç”¨ <code>UserDetailsService.loadUserByUsername(username)</code> åŠ è½½ç”¨æˆ·</li><li>æ¯”è¾ƒå¯†ç ï¼ˆé€šè¿‡ <code>PasswordEncoder.matches()</code>ï¼‰</li><li>å¦‚æœæˆåŠŸï¼Œè¿”å›ä¸€ä¸ªå·²è®¤è¯çš„ <code>Authentication</code> å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯ <code>UsernamePasswordAuthenticationToken</code>ï¼Œå…¶ <code>isAuthenticated=true</code>ï¼‰</li></ul><figure><img src="'+r+'" alt="image-20250413200521432" tabindex="0" loading="lazy"><figcaption>image-20250413200521432</figcaption></figure><figure><img src="'+d+'" alt="image-20250413195345945" tabindex="0" loading="lazy"><figcaption>image-20250413195345945</figcaption></figure><figure><img src="'+g+'" alt="image-20250413195916730" tabindex="0" loading="lazy"><figcaption>image-20250413195916730</figcaption></figure><figure><img src="'+c+'" alt="image-20250413200417847" tabindex="0" loading="lazy"><figcaption>image-20250413200417847</figcaption></figure><hr><h4 id="è®¤è¯æˆåŠŸå¤„ç†" tabindex="-1"><a class="header-anchor" href="#è®¤è¯æˆåŠŸå¤„ç†"><span>è®¤è¯æˆåŠŸå¤„ç†</span></a></h4><ul><li>å°†è®¤è¯æˆåŠŸçš„ Authentication å¯¹è±¡ä¿å­˜åˆ° <code>SecurityContextHolder</code></li><li>å¦‚æœå¼€å¯äº† sessionï¼Œå°±ä¼šå°†å®ƒå­˜å…¥ sessionï¼Œä»¥ä¾¿åç»­è¯·æ±‚ä¸­è‡ªåŠ¨æ¢å¤</li><li>è¿”å›ç™»å½•æˆåŠŸå“åº”ï¼ˆè·³è½¬é¡µé¢æˆ–è¿”å› JSONï¼‰</li></ul><figure><img src="'+A+'" alt="image-20250413201155502" tabindex="0" loading="lazy"><figcaption>image-20250413201155502</figcaption></figure><figure><img src="'+B+`" alt="image-20250413201245841" tabindex="0" loading="lazy"><figcaption>image-20250413201245841</figcaption></figure><h4 id="ä¹‹åçš„è¯·æ±‚æµç¨‹" tabindex="-1"><a class="header-anchor" href="#ä¹‹åçš„è¯·æ±‚æµç¨‹"><span>ä¹‹åçš„è¯·æ±‚æµç¨‹</span></a></h4><p>æ¯æ¬¡è¯·æ±‚ï¼š</p><ul><li>é€šè¿‡ <code>SecurityContextPersistenceFilter</code> ä» session æ¢å¤å‡ºè®¤è¯å¯¹è±¡</li><li>ç”± <code>FilterSecurityInterceptor</code> æ£€æŸ¥æ˜¯å¦æœ‰æƒé™è®¿é—®å½“å‰èµ„æº</li></ul><h2 id="åŠ¨æ‰‹å®æˆ˜-spring-security-è®¤è¯æµç¨‹é…ç½®-å‰åç«¯åˆ†ç¦»åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#åŠ¨æ‰‹å®æˆ˜-spring-security-è®¤è¯æµç¨‹é…ç½®-å‰åç«¯åˆ†ç¦»åœºæ™¯"><span>åŠ¨æ‰‹å®æˆ˜ï¼šSpring Security è®¤è¯æµç¨‹é…ç½®ï¼ˆå‰åç«¯åˆ†ç¦»åœºæ™¯ï¼‰</span></a></h2><h3 id="é¡¹ç›®åˆå§‹åŒ–ä¸ä¾èµ–é…ç½®" tabindex="-1"><a class="header-anchor" href="#é¡¹ç›®åˆå§‹åŒ–ä¸ä¾èµ–é…ç½®"><span>é¡¹ç›®åˆå§‹åŒ–ä¸ä¾èµ–é…ç½®</span></a></h3><p>å¼•å…¥ Maven ä¾èµ–ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;org.springframework.boot&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;spring-boot-starter-security&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;io.jsonwebtoken&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;jjwt&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;0.9.1&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é¡¹ç›®ç›®å½•ç»“æ„ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>src</span></span>
<span class="line"><span> â””â”€main</span></span>
<span class="line"><span>    â”œâ”€java</span></span>
<span class="line"><span>    â”‚  â””â”€cn</span></span>
<span class="line"><span>    â”‚     â””â”€springsecuritydemo</span></span>
<span class="line"><span>    â”‚         â”‚  SpringSecurityDemoApplication.java</span></span>
<span class="line"><span>    â”‚         â”‚</span></span>
<span class="line"><span>    â”‚         â”œâ”€controller</span></span>
<span class="line"><span>    â”‚         â”‚      AuthController.java</span></span>
<span class="line"><span>    â”‚         â”‚</span></span>
<span class="line"><span>    â”‚         â”œâ”€framework</span></span>
<span class="line"><span>    â”‚         â”‚  â”œâ”€config</span></span>
<span class="line"><span>    â”‚         â”‚  â”‚   SecurityConfig.java</span></span>
<span class="line"><span>    â”‚         â”‚  â”‚</span></span>
<span class="line"><span>    â”‚         â”‚  â””â”€security</span></span>
<span class="line"><span>    â”‚         â”‚      CustomAuthenticationEntryPoint.java</span></span>
<span class="line"><span>    â”‚         â”‚      JwtAuthenticationFilter.java</span></span>
<span class="line"><span>    â”‚         â”‚      UserDetailServiceImpl.java</span></span>
<span class="line"><span>    â”‚         â”‚</span></span>
<span class="line"><span>    â”‚         â”œâ”€model</span></span>
<span class="line"><span>    â”‚         â”‚      LoginRequest.java</span></span>
<span class="line"><span>    â”‚         â”‚</span></span>
<span class="line"><span>    â”‚         â””â”€utils</span></span>
<span class="line"><span>    â”‚                JwtTokenUtil.java</span></span>
<span class="line"><span>    â”‚</span></span>
<span class="line"><span>    â””â”€resources</span></span>
<span class="line"><span>           application.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="è‡ªå®šä¹‰ç”¨æˆ·ä¿¡æ¯åŠ è½½é€»è¾‘-å®ç°-userdetailsservice" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰ç”¨æˆ·ä¿¡æ¯åŠ è½½é€»è¾‘-å®ç°-userdetailsservice"><span>è‡ªå®šä¹‰ç”¨æˆ·ä¿¡æ¯åŠ è½½é€»è¾‘ï¼ˆå®ç° UserDetailsServiceï¼‰</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserDetailServiceImpl</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserDetailsService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserDetails</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> loadUserByUsername</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> username</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UsernameNotFoundException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // å®é™…å¯ä»æ•°æ®åº“ä¸­æŸ¥æ‰¾ç”¨æˆ·</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;admin&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(username)) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            throw</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UsernameNotFoundException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ç”¨æˆ·ä¸å­˜åœ¨&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // ä»æ•°æ®åº“ä¸­æŸ¥åˆ°çš„å¯†ç ï¼Œå¯†ç åº”è¯¥åŠ å¯†ï¼Œä¾‹ï¼šnew BCryptPasswordEncoder().encode(&quot;123456&quot;)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> org.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">springframework</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">security</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">core</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">userdetails</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">User</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                &quot;admin&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;$2a$10$abc...åŠ å¯†åçš„å¯†ç &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">AuthorityUtils</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">commaSeparatedStringToAuthorityList</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ROLE_USER&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        );</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="è‡ªå®šä¹‰ç™»å½•æ¥å£-è¿”å›-jwt" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰ç™»å½•æ¥å£-è¿”å›-jwt"><span>è‡ªå®šä¹‰ç™»å½•æ¥å£ï¼ˆè¿”å› JWTï¼‰</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/auth&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> AuthController</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> AuthenticationManager</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> authenticationManager</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> JwtTokenUtil</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> jwtTokenUtil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">PostMapping</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/login&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> login</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">RequestBody</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> LoginRequest</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        UsernamePasswordAuthenticationToken</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> token</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UsernamePasswordAuthenticationToken</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUsername</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getPassword</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">            Authentication</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> auth</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> authenticationManager</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">authenticate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(token);</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> jwt</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> jwtTokenUtil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">generateToken</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(auth);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ok</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">Map</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">of</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;token&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, jwt));</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">AuthenticationException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> ResponseEntity</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">status</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">HttpStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">UNAUTHORIZED</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">body</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ç™»å½•å¤±è´¥&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç™»å½•è¯·æ±‚ä½“æ¨¡å‹</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Data</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> LoginRequest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> username</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> password</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="jwt-å·¥å…·ç±»-æ‹¦æˆªå™¨-æ ¸å¿ƒ" tabindex="-1"><a class="header-anchor" href="#jwt-å·¥å…·ç±»-æ‹¦æˆªå™¨-æ ¸å¿ƒ"><span>JWT å·¥å…·ç±» + æ‹¦æˆªå™¨ï¼ˆæ ¸å¿ƒï¼‰</span></a></h3><p><code>JwtTokenUtil.java</code>ï¼ˆç”Ÿæˆ + æ ¡éªŒï¼‰</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> JwtTokenUtil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> secret </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;my-secret&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> long</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> expiration </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 86400000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // 1å¤©</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> generateToken</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Authentication</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> authentication</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> username</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> authentication</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Jwts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">builder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setSubject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(username)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setIssuedAt</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setExpiration</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">System</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">currentTimeMillis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> expiration))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">signWith</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">SignatureAlgorithm</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">HS512</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, secret)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">compact</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> getUsernameFromToken</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> token</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> Jwts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">parser</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setSigningKey</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(secret)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">parseClaimsJws</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(token).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getBody</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getSubject</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> validateToken</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> token</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">            Jwts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">parser</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setSigningKey</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(secret).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">parseClaimsJws</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(token);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">JwtException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>JwtAuthenticationFilter.java</code>ï¼ˆè®¤è¯è¿‡æ»¤å™¨ï¼‰</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> JwtAuthenticationFilter</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> OncePerRequestFilter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> JwtTokenUtil</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> jwtTokenUtil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserDetailsService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> userDetailsService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    protected</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> doFilterInternal</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">FilterChain</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> filterChain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ServletException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> token</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getHeader</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Authorization&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (token </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> token</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">startsWith</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Bearer &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            token </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> token</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">substring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ç§»é™¤å‰ç¼€</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">            String</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> username</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> jwtTokenUtil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getUsernameFromToken</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(token);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (username </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> SecurityContextHolder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getContext</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getAuthentication</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">                UserDetails</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> userDetails</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> userDetailsService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">loadUserByUsername</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(username);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">jwtTokenUtil</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">validateToken</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(token)) {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">                    UsernamePasswordAuthenticationToken</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> authToken</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">                            new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> UsernamePasswordAuthenticationToken</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(userDetails, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">userDetails</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getAuthorities</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                    authToken</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setDetails</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> WebAuthenticationDetailsSource</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">buildDetails</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(request));</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">                    SecurityContextHolder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getContext</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setAuthentication</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(authToken);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        filterChain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">doFilter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(request, response);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="securityconfig-é…ç½®ç±»" tabindex="-1"><a class="header-anchor" href="#securityconfig-é…ç½®ç±»"><span>SecurityConfig é…ç½®ç±»</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">EnableWebSecurity</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> SecurityConfig</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> JwtAuthenticationFilter</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> jwtAuthenticationFilter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> UserDetailsService</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> userDetailsService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Resource</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> CustomAuthenticationEntryPoint</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> unauthorizedHandler</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> AuthenticationManager</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> authenticationManager</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpSecurity</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">PasswordEncoder</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> encoder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">        DaoAuthenticationProvider</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> provider</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> DaoAuthenticationProvider</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        provider</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setUserDetailsService</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(userDetailsService);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        provider</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setPasswordEncoder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(encoder);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ProviderManager</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(provider);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> PasswordEncoder</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> passwordEncoder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> BCryptPasswordEncoder</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ç”¨äºåŠ å¯†å¯†ç </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> SecurityFilterChain</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> filterChain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpSecurity</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> http</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                // CSRFç¦ç”¨ï¼Œå› ä¸ºä¸ä½¿ç”¨session</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">csrf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(CsrfConfigurer</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">::</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">disable)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                // åŸºäºtokenï¼Œæ‰€ä»¥ä¸éœ€è¦session</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sessionManagement</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(session </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> session</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sessionCreationPolicy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">SessionCreationPolicy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">STATELESS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                // æ ‡è®°å…è®¸åŒ¿åè®¿é—®çš„url</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">authorizeHttpRequests</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(auth </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> auth</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">requestMatchers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/auth/login&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">permitAll</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                        .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">anyRequest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">authenticated</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                )</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">exceptionHandling</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(exception </span><span style="--shiki-light:#C18401;--shiki-dark:#C678DD;">-&gt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">authenticationEntryPoint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(unauthorizedHandler))</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                // æ·»åŠ JWT filter</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addFilterBefore</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(jwtAuthenticationFilter, </span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">UsernamePasswordAuthenticationFilter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è‡ªå®šä¹‰å¼‚å¸¸è¿”å›ï¼ˆè®¤è¯å¤±è´¥ï¼‰</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Component</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> CustomAuthenticationEntryPoint</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> AuthenticationEntryPoint</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#A626A4;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> commence</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">AuthenticationException</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> authException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ServletException</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setContentType</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;application/json&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setStatus</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">SC_UNAUTHORIZED</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">getWriter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;{</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">error</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">: </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">æœªè®¤è¯ï¼Œè¯·ç™»å½•</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">}&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="æœ€ç»ˆæ•ˆæœ" tabindex="-1"><a class="header-anchor" href="#æœ€ç»ˆæ•ˆæœ"><span>æœ€ç»ˆæ•ˆæœ</span></a></h3><ul><li><code>POST /auth/login</code> ç”¨äºç™»å½•ï¼Œå‰ç«¯æä¾› <code>username + password</code>ï¼Œåç«¯è¿”å› JWTã€‚</li><li>å‰ç«¯å°† <code>token</code> å­˜å…¥ localStorage æˆ– Cookieï¼Œåœ¨åç»­è¯·æ±‚ä¸­é€šè¿‡ <code>Authorization: Bearer &lt;token&gt;</code> ä¼ é€’ã€‚</li><li>æ‰€æœ‰è¯·æ±‚é»˜è®¤éƒ½éœ€è®¤è¯ï¼ˆé™¤äº†åœ¨ <code>.requestMatchers()</code> ä¸­æ”¾è¡Œçš„åœ°å€ï¼‰ã€‚</li></ul><h2 id="æ€»ç»“ä¸å»¶ä¼¸" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“ä¸å»¶ä¼¸"><span>æ€»ç»“ä¸å»¶ä¼¸</span></a></h2><p>Spring Security çš„è®¤è¯æµç¨‹è™½ç„¶ç”±å¤šä¸ªç»„ä»¶åä½œå®Œæˆï¼Œä½†æ ¸å¿ƒé€»è¾‘æ¸…æ™°ï¼š</p><blockquote><p><strong>è¯†åˆ«è¯·æ±‚ â†’ å§”æ‰˜è®¤è¯ â†’ åŠ è½½ç”¨æˆ· â†’ æ ¡éªŒå¯†ç  â†’ ä¿å­˜çŠ¶æ€</strong></p></blockquote><hr><h3 id="è‡ªå®šä¹‰ç™»å½•çš„æ‰©å±•ç‚¹" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰ç™»å½•çš„æ‰©å±•ç‚¹"><span>è‡ªå®šä¹‰ç™»å½•çš„æ‰©å±•ç‚¹</span></a></h3><ul><li>æ›¿æ¢ <code>UserDetailsService</code> â†’ è¿æ¥æ•°æ®åº“ã€Redisã€LDAP ç­‰</li><li>è‡ªå®šä¹‰ <code>AuthenticationProvider</code> â†’ å®ç°æ‰‹æœºéªŒè¯ç ã€OAuth2 ç­‰è®¤è¯æ–¹å¼</li></ul>`,79)]))}const m=s(y,[["render",o],["__file","SpringSecurityè®¤è¯æµç¨‹.html.vue"]]),C=JSON.parse('{"path":"/topic/java/%E5%B8%B8%E7%94%A8%E6%A1%86%E6%9E%B6/SpringSecurity/SpringSecurity%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B.html","title":"SpringSecurity è®¤è¯æµç¨‹å…¨è§£æ","lang":"zh-CN","frontmatter":{"title":"SpringSecurity è®¤è¯æµç¨‹å…¨è§£æ","category":["Java","å¸¸ç”¨æ¡†æ¶"],"tag":["SpringSecurity"],"order":1,"description":"SpringSecurity è®¤è¯æµç¨‹å…¨è§£æ å¼•è¨€ Spring Security æ˜¯ Spring å…¨å®¶æ¡¶ä¸­ç”¨äºå¤„ç†å®‰å…¨è®¤è¯ä¸æˆæƒçš„æ ¸å¿ƒæ¨¡å—ã€‚æœ¬æ–‡å°†èšç„¦åœ¨â€œè®¤è¯æµç¨‹â€çš„æœºåˆ¶è§£æï¼Œå¸®åŠ©ä½ ç†è§£ä»æäº¤ç”¨æˆ·åå¯†ç å¼€å§‹ï¼Œåˆ°ç™»å½•æˆåŠŸèƒŒååˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚ è®¤è¯æµç¨‹è¯¦è§£ æ€»ä½“æµç¨‹æ€»è§ˆ Spring Security çš„è¡¨å•è®¤è¯æµç¨‹ï¼Œå¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Untitled...","head":[["meta",{"property":"og:url","content":"https://jishuzhaix.cn/topic/java/%E5%B8%B8%E7%94%A8%E6%A1%86%E6%9E%B6/SpringSecurity/SpringSecurity%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B.html"}],["meta",{"property":"og:site_name","content":"æŠ€æ•°æ–‹"}],["meta",{"property":"og:title","content":"SpringSecurity è®¤è¯æµç¨‹å…¨è§£æ"}],["meta",{"property":"og:description","content":"SpringSecurity è®¤è¯æµç¨‹å…¨è§£æ å¼•è¨€ Spring Security æ˜¯ Spring å…¨å®¶æ¡¶ä¸­ç”¨äºå¤„ç†å®‰å…¨è®¤è¯ä¸æˆæƒçš„æ ¸å¿ƒæ¨¡å—ã€‚æœ¬æ–‡å°†èšç„¦åœ¨â€œè®¤è¯æµç¨‹â€çš„æœºåˆ¶è§£æï¼Œå¸®åŠ©ä½ ç†è§£ä»æäº¤ç”¨æˆ·åå¯†ç å¼€å§‹ï¼Œåˆ°ç™»å½•æˆåŠŸèƒŒååˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚ è®¤è¯æµç¨‹è¯¦è§£ æ€»ä½“æµç¨‹æ€»è§ˆ Spring Security çš„è¡¨å•è®¤è¯æµç¨‹ï¼Œå¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Untitled..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-04-19T13:54:41.000Z"}],["meta",{"property":"article:tag","content":"SpringSecurity"}],["meta",{"property":"article:modified_time","content":"2025-04-19T13:54:41.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"SpringSecurity è®¤è¯æµç¨‹å…¨è§£æ\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-04-19T13:54:41.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"è´ºå¢¨äº\\",\\"url\\":\\"https://jishuzhaix.cn\\"}]}"]]},"headers":[{"level":2,"title":"å¼•è¨€","slug":"å¼•è¨€","link":"#å¼•è¨€","children":[]},{"level":2,"title":"è®¤è¯æµç¨‹è¯¦è§£","slug":"è®¤è¯æµç¨‹è¯¦è§£","link":"#è®¤è¯æµç¨‹è¯¦è§£","children":[{"level":3,"title":"æ€»ä½“æµç¨‹æ€»è§ˆ","slug":"æ€»ä½“æµç¨‹æ€»è§ˆ","link":"#æ€»ä½“æµç¨‹æ€»è§ˆ","children":[]},{"level":3,"title":"æ ¸å¿ƒç»„ä»¶ä½œç”¨è¯´æ˜","slug":"æ ¸å¿ƒç»„ä»¶ä½œç”¨è¯´æ˜","link":"#æ ¸å¿ƒç»„ä»¶ä½œç”¨è¯´æ˜","children":[]},{"level":3,"title":"æ ¸å¿ƒæµç¨‹è§£æ","slug":"æ ¸å¿ƒæµç¨‹è§£æ","link":"#æ ¸å¿ƒæµç¨‹è§£æ","children":[{"level":4,"title":"è¯·æ±‚è¿›å…¥ SpringSecurity è¿‡æ»¤å™¨é“¾","slug":"è¯·æ±‚è¿›å…¥-springsecurity-è¿‡æ»¤å™¨é“¾","link":"#è¯·æ±‚è¿›å…¥-springsecurity-è¿‡æ»¤å™¨é“¾","children":[]},{"level":4,"title":"æ•è·ç™»å½•è¯·æ±‚","slug":"æ•è·ç™»å½•è¯·æ±‚","link":"#æ•è·ç™»å½•è¯·æ±‚","children":[]},{"level":4,"title":"è°ƒç”¨ AuthenticationManager è¿›è¡Œè®¤è¯","slug":"è°ƒç”¨-authenticationmanager-è¿›è¡Œè®¤è¯","link":"#è°ƒç”¨-authenticationmanager-è¿›è¡Œè®¤è¯","children":[]},{"level":4,"title":"è®¤è¯æä¾›è€… AuthenticationProvider","slug":"è®¤è¯æä¾›è€…-authenticationprovider","link":"#è®¤è¯æä¾›è€…-authenticationprovider","children":[]},{"level":4,"title":"è®¤è¯æˆåŠŸå¤„ç†","slug":"è®¤è¯æˆåŠŸå¤„ç†","link":"#è®¤è¯æˆåŠŸå¤„ç†","children":[]},{"level":4,"title":"ä¹‹åçš„è¯·æ±‚æµç¨‹","slug":"ä¹‹åçš„è¯·æ±‚æµç¨‹","link":"#ä¹‹åçš„è¯·æ±‚æµç¨‹","children":[]}]}]},{"level":2,"title":"åŠ¨æ‰‹å®æˆ˜ï¼šSpring Security è®¤è¯æµç¨‹é…ç½®ï¼ˆå‰åç«¯åˆ†ç¦»åœºæ™¯ï¼‰","slug":"åŠ¨æ‰‹å®æˆ˜-spring-security-è®¤è¯æµç¨‹é…ç½®-å‰åç«¯åˆ†ç¦»åœºæ™¯","link":"#åŠ¨æ‰‹å®æˆ˜-spring-security-è®¤è¯æµç¨‹é…ç½®-å‰åç«¯åˆ†ç¦»åœºæ™¯","children":[{"level":3,"title":"é¡¹ç›®åˆå§‹åŒ–ä¸ä¾èµ–é…ç½®","slug":"é¡¹ç›®åˆå§‹åŒ–ä¸ä¾èµ–é…ç½®","link":"#é¡¹ç›®åˆå§‹åŒ–ä¸ä¾èµ–é…ç½®","children":[]},{"level":3,"title":"è‡ªå®šä¹‰ç”¨æˆ·ä¿¡æ¯åŠ è½½é€»è¾‘ï¼ˆå®ç° UserDetailsServiceï¼‰","slug":"è‡ªå®šä¹‰ç”¨æˆ·ä¿¡æ¯åŠ è½½é€»è¾‘-å®ç°-userdetailsservice","link":"#è‡ªå®šä¹‰ç”¨æˆ·ä¿¡æ¯åŠ è½½é€»è¾‘-å®ç°-userdetailsservice","children":[]},{"level":3,"title":"è‡ªå®šä¹‰ç™»å½•æ¥å£ï¼ˆè¿”å› JWTï¼‰","slug":"è‡ªå®šä¹‰ç™»å½•æ¥å£-è¿”å›-jwt","link":"#è‡ªå®šä¹‰ç™»å½•æ¥å£-è¿”å›-jwt","children":[]},{"level":3,"title":"JWT å·¥å…·ç±» + æ‹¦æˆªå™¨ï¼ˆæ ¸å¿ƒï¼‰","slug":"jwt-å·¥å…·ç±»-æ‹¦æˆªå™¨-æ ¸å¿ƒ","link":"#jwt-å·¥å…·ç±»-æ‹¦æˆªå™¨-æ ¸å¿ƒ","children":[]},{"level":3,"title":"SecurityConfig é…ç½®ç±»","slug":"securityconfig-é…ç½®ç±»","link":"#securityconfig-é…ç½®ç±»","children":[]},{"level":3,"title":"æœ€ç»ˆæ•ˆæœ","slug":"æœ€ç»ˆæ•ˆæœ","link":"#æœ€ç»ˆæ•ˆæœ","children":[]}]},{"level":2,"title":"æ€»ç»“ä¸å»¶ä¼¸","slug":"æ€»ç»“ä¸å»¶ä¼¸","link":"#æ€»ç»“ä¸å»¶ä¼¸","children":[{"level":3,"title":"è‡ªå®šä¹‰ç™»å½•çš„æ‰©å±•ç‚¹","slug":"è‡ªå®šä¹‰ç™»å½•çš„æ‰©å±•ç‚¹","link":"#è‡ªå®šä¹‰ç™»å½•çš„æ‰©å±•ç‚¹","children":[]}]}],"git":{"createdTime":1745070881000,"updatedTime":1745070881000,"contributors":[{"name":"HeMOu","username":"HeMOu","email":"fangqichenchao@163.com","commits":1,"url":"https://github.com/HeMOu"}]},"readingTime":{"minutes":5.25,"words":1575},"filePathRelative":"topic/java/å¸¸ç”¨æ¡†æ¶/SpringSecurity/SpringSecurityè®¤è¯æµç¨‹.md","localizedDate":"2025å¹´4æœˆ19æ—¥","excerpt":"\\n<h2>å¼•è¨€</h2>\\n<blockquote>\\n<p>Spring Security æ˜¯ Spring å…¨å®¶æ¡¶ä¸­ç”¨äºå¤„ç†å®‰å…¨è®¤è¯ä¸æˆæƒçš„æ ¸å¿ƒæ¨¡å—ã€‚æœ¬æ–‡å°†èšç„¦åœ¨â€œè®¤è¯æµç¨‹â€çš„æœºåˆ¶è§£æï¼Œå¸®åŠ©ä½ ç†è§£ä»æäº¤ç”¨æˆ·åå¯†ç å¼€å§‹ï¼Œåˆ°ç™»å½•æˆåŠŸèƒŒååˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p>\\n</blockquote>\\n<h2>è®¤è¯æµç¨‹è¯¦è§£</h2>\\n<h3>æ€»ä½“æµç¨‹æ€»è§ˆ</h3>\\n<p>Spring Security çš„è¡¨å•è®¤è¯æµç¨‹ï¼Œå¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\\n<figure><figcaption>Untitled diagram-2025-04-13-041823</figcaption></figure>\\n<ol>\\n<li>\\n<p>ç”¨æˆ·å‘èµ·ç™»å½•è¯·æ±‚</p>\\n</li>\\n<li>\\n<p>è¯†åˆ«åˆ° <code>/login</code> ç™»å½•è¯·æ±‚ï¼Œäº¤ç»™ <code>UsernamePasswordAuthenticationFilter</code> è¿‡æ»¤å™¨å¤„ç†</p>\\n</li>\\n<li>\\n<p>ä»è¯·æ±‚ä¸­æå–ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶å°è£…æˆ <code>UsernamePasswordAuthenticationToken</code>ï¼Œç„¶åè°ƒç”¨ <code>AuthenticationManager</code> çš„ <code>authenticate()</code>  è®¤è¯æ–¹æ³•</p>\\n</li>\\n<li>\\n<p>è°ƒç”¨ <code>ProviderManager.authenticate()</code>ï¼Œå®ƒä¼šéå†æ‰€æœ‰ <code>supports</code> çš„ <code>AuthenticationProvider</code></p>\\n</li>\\n<li>\\n<p>é»˜è®¤æ˜¯ <code>DaoAuthenticationProvider</code> ï¼Œè°ƒç”¨ <code>authenticate()</code></p>\\n<ul>\\n<li>\\n<p>è°ƒç”¨ <code>retrieveUser()</code> -&gt; <code>UserDetailsService.loadUserByUsername()</code></p>\\n</li>\\n<li>\\n<p>æ ¡éªŒå¯†ç ï¼š<code>additionalAuthenticationChecks()</code></p>\\n</li>\\n</ul>\\n</li>\\n<li>\\n<p>è¿”å›å·²è®¤è¯ Authentication å¯¹è±¡ï¼Œå­˜å…¥ SecurityContextHolder</p>\\n</li>\\n</ol>","autoDesc":true}');export{m as comp,C as data};
